# Reservé — Physical-Book-First MVP

Reservé is a quiet, paid reading room for physical books. The app never renders full book text. It focuses on ritual, atmosphere, and gentle fulfillment metrics.

## Features
- Opening ritual quote on app open (daily deterministic).
- Monthly fulfillment snapshot (sessions + total time).
- Monthly edition with 5–7 curated physical books.
- Session ritual (30/60/90) with pause/resume and hide ticker.
- Built-in cafe ambience audio (local, no lyrics).
- Digital concierge with curated responses (local-only).
- Tribe reading circles (local-only prototype).
- Minimal settings and membership gate (local mock).

## Run Locally
```bash
npm install
npm run dev
```
Open `http://localhost:3000`.

## Tests
```bash
npm run test
```

## Data Builds
Generate the catalog and quote datasets (recommended before production deploys):
```bash
npm run build:books
npm run build:quotes
```
`build:books` uses the Open Library Search API with rate limiting.
Set `OPEN_LIBRARY_USER_AGENT` to include a contact email (recommended by Open Library).
If you prefer bulk dumps instead, run `npm run build:books:dumps`.
`build:quotes` downloads public-domain texts from Project Gutenberg.

## Deploy
### Vercel
- Build command: `npm run build`
- Output: Next.js default

### Netlify
- Build command: `npm run build`
- Start command: `npm run start`

## Content Configuration
### Monthly Edition
- Edit `data/edition.json` to update the edition.
- Required fields: `start_date`, `end_date`, and `books[]`.
- Each book includes `title`, `author`, `why_this_book`, `best_context`, `estimated_sessions`.
- The app enforces a maximum of 7 books.

### Book Catalog
- Generated by `npm run build:books` into `data/books.json`.
- API builder: `scripts/build-books-api.mjs` (default).
- Dump builder: `scripts/build-books.mjs` (optional).
- Tagging is controlled by `data/taxonomy.json` and keyword rules in the builder script.

### Quotes
- Edit `data/quotes.json`.
- The ritual quote is deterministic per local day.
- To regenerate 1000 stoicism + book/reading quotes, run `npm run build:quotes`.

### Audio
- Tracks are stored in `public/audio/` and referenced in `data/audio.json`.
- Default files are 30-second looping WAVs (~1.3MB each at 22.05kHz).
- Attribution is in `docs/audio-attribution.md`.

## Membership Handling
Membership is stored locally in `localStorage` under `reserve:member`.

### Mock Unlock (default)
On `/paywall`, use **Unlock (Test)** to set `isMember=true` locally.

### Stripe Checkout (test mode ready)
If you provide a hosted Stripe Checkout URL, the Paywall will send users there.
Set an environment variable:
```
NEXT_PUBLIC_STRIPE_CHECKOUT_URL=https://your-checkout-link
```
This MVP does not create Checkout sessions because there is no backend.

## Edition Rotation
- Editions are active only between `start_date` and `end_date`.
- Outside that range, the list is hidden and a “not active” message appears.

## Concierge
- Non-real-time chat with curated responses.
- Suggestions default to the current edition, with optional catalog-based picks.
- No typing indicators or notifications.
- Set `OPENAI_API_KEY` in `.env.local` to enable live concierge responses.
- Optional: set `CONCIERGE_MODE=edition|catalog|blend` to control how suggestions are sourced.

## My Library
- Add your current physical book and store it locally.
- When you add a book, the app calls `/api/book-summary` to generate a short summary.
- Requires `OPENAI_API_KEY` for summaries.

## Tribe
- Local-only circles per book, edition-scoped.
- Capacity is capped at 5–15 seats (default 12).
- No likes, no DMs, no follower graph.
- Optional weekly prompt, no notifications by default.

## Notes
- Authentication is local-only and stored in the browser.
- Monthly fulfillment stats are stored locally per device.
- No in-app reading experience is present by design.
